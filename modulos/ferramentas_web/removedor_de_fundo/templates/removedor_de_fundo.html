{% extends "base.html" %}

{% block title %}Removedor de Fundo IA - Escolha seu Modelo{% endblock %}

{% block styles %}
<style>
    .remover-wrapper {
        padding: 1rem;
        width: 100%;
        margin: 0;
        min-height: calc(100vh - var(--header-height));
    }

    /* Header */
    .remover-header {
        background: linear-gradient(135deg, #0ea5e9, #6366f1);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        color: white;
    }

    .remover-header-content {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .remover-icon {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        flex-shrink: 0;
    }

    .remover-header-text h1 {
        margin: 0;
        font-size: 1.75rem;
        font-weight: 700;
        line-height: 1.2;
    }

    .remover-header-text p {
        margin: 0;
        opacity: 0.9;
        font-size: 1rem;
        line-height: 1.4;
    }

    /* Layout Principal */
    .remover-main-layout {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
        align-items: start;
    }

    /* Se√ß√µes */
    .remover-tool-section, .remover-settings-section {
        background: var(--bg-elevated);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: var(--shadow-elevated);
        border: 1px solid var(--border-color);
    }

    .remover-settings-section {
        position: sticky;
        top: 1rem;
    }

    /* Seletor de Modelo */
    .model-selector {
        margin-bottom: 2rem;
    }

    .model-selector h4 {
        color: var(--text-primary);
        margin-bottom: 1rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .model-grid {
        display: grid;
        gap: 0.75rem;
    }

    .model-option {
        border: 2px solid var(--border-color);
        border-radius: 12px;
        padding: 1rem;
        cursor: pointer;
        transition: var(--transition-base);
        background: var(--bg-base);
        min-height: 44px; /* Touch target */
        display: flex;
        flex-direction: column;
        justify-content: center;
        touch-action: manipulation;
    }

    .model-option:hover {
        border-color: var(--primary-light);
        background: var(--primary-alpha);
    }

    .model-option.active {
        border-color: var(--primary);
        background: var(--primary-alpha);
    }

    .model-option input[type="radio"] {
        display: none;
    }

    .model-name {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
        font-size: 0.95rem;
        line-height: 1.3;
    }

    .model-description {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
        line-height: 1.4;
    }

    .model-badges {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .model-badge {
        background: var(--bg-muted);
        color: var(--text-secondary);
        padding: 0.2rem 0.5rem;
        border-radius: 6px;
        font-size: 0.7rem;
        font-weight: 500;
        white-space: nowrap;
    }

    .model-badge.speed { background: rgba(34, 197, 94, 0.1); color: #22c55e; }
    .model-badge.quality { background: rgba(99, 102, 241, 0.1); color: #6366f1; }

    /* Qualidade */
    .quality-selector {
        margin-bottom: 2rem;
    }

    .quality-selector h5 {
        color: var(--text-primary);
        margin-bottom: 0.75rem;
        font-weight: 600;
    }

    .quality-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
    }

    .quality-option {
        border: 2px solid var(--border-color);
        border-radius: 8px;
        padding: 0.75rem;
        cursor: pointer;
        transition: var(--transition-base);
        text-align: center;
        background: var(--bg-base);
        min-height: 44px; /* Touch target */
        display: flex;
        align-items: center;
        justify-content: center;
        touch-action: manipulation;
    }

    .quality-option:hover {
        border-color: var(--primary-light);
    }

    .quality-option.active {
        border-color: var(--primary);
        background: var(--primary-alpha);
    }

    .quality-option input[type="radio"] {
        display: none;
    }

    .quality-name {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.85rem;
    }

    /* Upload Area */
    .upload-area {
        border: 3px dashed var(--border-color);
        border-radius: 16px;
        padding: 3rem 2rem;
        text-align: center;
        cursor: pointer;
        transition: var(--transition-base);
        background: var(--bg-base);
        margin-bottom: 2rem;
        min-height: 150px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .upload-area:hover, .upload-area.dragover {
        border-color: var(--primary);
        background: var(--primary-alpha);
        transform: scale(1.01);
    }

    .upload-icon {
        font-size: 3rem;
        color: var(--primary);
        margin-bottom: 1rem;
    }

    .upload-text h4 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        font-weight: 600;
    }

    .upload-text p {
        color: var(--text-secondary);
        margin: 0;
        margin-bottom: 0.5rem;
    }

    /* Preview */
    .preview-area {
        display: none;
        margin-bottom: 2rem;
    }

    .preview-area.show { display: block; }

    .preview-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .preview-item {
        background: var(--bg-base);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
    }

    .preview-label {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 0.9rem;
    }

    .preview-image {
        width: 100%;
        max-height: 300px;
        object-fit: contain;
        border-radius: 8px;
        background: var(--bg-muted);
    }

    .empty-state {
        margin-top: 1rem;
        color: var(--text-secondary);
        font-size: 0.9rem;
        border: 1px dashed var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        background: var(--bg-base);
        line-height: 1.4;
    }

    /* Processing */
    .processing-area {
        display: none;
        text-align: center;
        padding: 2rem;
        background: var(--bg-base);
        border-radius: 12px;
        margin-bottom: 2rem;
    }

    .processing-area.show { display: block; }

    .processing-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid var(--border-color);
        border-top: 4px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .processing-text {
        color: var(--text-primary);
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .processing-subtext {
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    /* Bot√µes */
    .btn-process {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 12px;
        padding: 1rem 2rem;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition-base);
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
        min-height: 48px; /* Touch target */
        touch-action: manipulation;
    }

    .btn-process:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(14, 165, 233, 0.4);
    }

    .btn-process:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    .btn-download {
        background: var(--success);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 1rem 2rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition-base);
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        display: none;
        min-height: 48px; /* Touch target */
        touch-action: manipulation;
    }

    .btn-download.show { display: flex; }

    .btn-download:hover {
        background: var(--success-dark);
        transform: translateY(-1px);
    }

    .btn-new {
        background: var(--bg-muted);
        color: var(--text-primary);
        border: 2px solid var(--border-color);
        border-radius: 12px;
        padding: 1rem 2rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition-base);
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 1rem;
        display: none;
        min-height: 48px; /* Touch target */
        touch-action: manipulation;
    }

    .btn-new.show { display: flex; }

    .btn-new:hover {
        border-color: var(--primary);
        background: var(--primary-alpha);
    }

    /* Alert */
    .alert-message {
        display: none;
        padding: 0.85rem 1rem;
        border-radius: 10px;
        margin-bottom: 1rem;
        font-weight: 600;
        line-height: 1.4;
    }

    .alert-message.show { display: block; }
    .alert-message.info { background: var(--primary-alpha); color: var(--primary); }
    .alert-message.success { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
    .alert-message.error { background: rgba(239, 68, 68, 0.15); color: #ef4444; }

    /* File Info */
    .file-info {
        background: var(--bg-base);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 2rem;
        display: none;
    }

    .file-info.show { display: block; }

    .file-name {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        word-break: break-word;
    }

    .file-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    .file-detail {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .file-detail-label {
        font-weight: 600;
        color: var(--text-primary);
    }

    /* Info Tips */
    .info-tips {
        background: var(--bg-base);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1rem;
        margin-top: 1.5rem;
    }

    .info-tips h6 {
        color: var(--primary);
        margin-bottom: 0.5rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .tips-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .tips-list li {
        padding: 0.25rem 0;
        font-size: 0.85rem;
        color: var(--text-secondary);
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        line-height: 1.4;
    }

    .tips-list li:before {
        content: "‚Ä¢";
        color: var(--primary);
        font-weight: bold;
        margin-top: 0.1rem;
        flex-shrink: 0;
    }

    /* ========================================
       RESPONSIVE DESIGN - CORRIGIDO
    ======================================== */

    /* Tablet portrait */
    @media (max-width: 968px) {
        .remover-main-layout {
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .remover-tool-section {
            order: 1; /* Upload primeiro */
        }

        .remover-settings-section {
            order: 2; /* Configura√ß√µes depois */
            position: static;
        }
    }

    /* Tablet */
    @media (max-width: 768px) {
        .remover-wrapper {
            padding: 0.75rem;
        }

        .remover-header {
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .remover-header-content {
            gap: 0.75rem;
        }

        .remover-icon {
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
        }

        .remover-header-text h1 {
            font-size: 1.5rem;
        }

        .remover-header-text p {
            font-size: 0.9rem;
        }

        .remover-tool-section,
        .remover-settings-section {
            padding: 1.5rem;
        }

        .model-grid {
            gap: 0.5rem;
        }

        .quality-options {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }

        .upload-area {
            padding: 2.5rem 1.5rem;
            min-height: 140px;
        }

        .upload-icon {
            font-size: 2.5rem;
        }

        .upload-text h4 {
            font-size: 1.1rem;
        }

        .upload-text p {
            font-size: 0.9rem;
        }

        .file-details {
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .preview-image {
            max-height: 250px;
        }

        .preview-container {
            grid-template-columns: 1fr;
        }
    }

    /* Mobile landscape */
    @media (max-width: 640px) {
        .remover-wrapper {
            padding: 0.5rem;
        }

        .remover-header {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 12px;
        }

        .remover-header-text h1 {
            font-size: 1.4rem;
        }

        .remover-header-text p {
            font-size: 0.85rem;
        }

        .remover-tool-section,
        .remover-settings-section {
            padding: 1.25rem;
            border-radius: 12px;
        }

        .model-option {
            padding: 0.875rem;
        }

        .model-name {
            font-size: 0.9rem;
        }

        .model-description {
            font-size: 0.75rem;
        }

        .model-badge {
            padding: 0.15rem 0.4rem;
            font-size: 0.65rem;
        }

        .quality-option {
            padding: 0.625rem;
            min-height: 44px;
        }

        .quality-name {
            font-size: 0.8rem;
        }

        .upload-area {
            padding: 2rem 1rem;
            min-height: 120px;
            margin-bottom: 1.5rem;
        }

        .upload-icon {
            font-size: 2.25rem;
            margin-bottom: 0.75rem;
        }

        .upload-text h4 {
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .upload-text p {
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
        }

        .upload-text small {
            font-size: 0.75rem;
        }

        .file-details {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }

        .preview-image {
            max-height: 200px;
        }

        .empty-state {
            font-size: 0.85rem;
            padding: 0.875rem;
        }

        .btn-process, .btn-download, .btn-new {
            padding: 1rem 1.5rem;
            font-size: 1rem;
            margin-bottom: 1rem;
            min-height: 50px;
        }

        .processing-spinner {
            width: 50px;
            height: 50px;
            border-width: 3px;
        }
    }

    /* Mobile portrait */
    @media (max-width: 480px) {
        .remover-wrapper {
            padding: 0.25rem;
        }

        .remover-header {
            padding: 0.875rem;
            margin-bottom: 1rem;
        }

        .remover-header-content {
            gap: 0.5rem;
        }

        .remover-icon {
            width: 40px;
            height: 40px;
            font-size: 1.25rem;
        }

        .remover-header-text h1 {
            font-size: 1.25rem;
        }

        .remover-header-text p {
            font-size: 0.8rem;
        }

        .remover-tool-section,
        .remover-settings-section {
            padding: 1rem;
        }

        .model-option {
            padding: 0.75rem;
        }

        .model-name {
            font-size: 0.85rem;
        }

        .model-description {
            font-size: 0.7rem;
        }

        .model-badges {
            gap: 0.25rem;
        }

        .model-badge {
            padding: 0.125rem 0.375rem;
            font-size: 0.6rem;
        }

        .quality-option {
            padding: 0.5rem;
            min-height: 44px;
        }

        .quality-name {
            font-size: 0.75rem;
        }

        .upload-area {
            padding: 1.5rem 0.75rem;
            min-height: 100px;
            margin-bottom: 1.25rem;
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .upload-text h4 {
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .upload-text p {
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }

        .upload-text small {
            font-size: 0.7rem;
        }

        .file-info {
            padding: 0.875rem;
        }

        .file-name {
            font-size: 0.9rem;
        }

        .file-details {
            grid-template-columns: 1fr;
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .preview-container {
            gap: 0.75rem;
        }

        .preview-item {
            padding: 0.75rem;
        }

        .preview-label {
            font-size: 0.85rem;
            margin-bottom: 0.375rem;
        }

        .preview-image {
            max-height: 150px;
        }

        .empty-state {
            font-size: 0.8rem;
            padding: 0.75rem;
        }

        .btn-process, .btn-download, .btn-new {
            padding: 0.875rem 1.25rem;
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
            min-height: 48px;
        }

        .processing-area {
            padding: 1.5rem;
        }

        .processing-text {
            font-size: 0.95rem;
        }

        .processing-subtext {
            font-size: 0.8rem;
        }

        .alert-message {
            padding: 0.75rem;
            font-size: 0.9rem;
        }

        .info-tips {
            padding: 0.875rem;
            margin-top: 1rem;
        }

        .info-tips h6 {
            font-size: 0.9rem;
        }

        .tips-list li {
            font-size: 0.8rem;
            padding: 0.2rem 0;
        }
    }

    /* Small mobile */
    @media (max-width: 360px) {
        .remover-wrapper {
            padding: 0.125rem;
        }

        .remover-header {
            padding: 0.75rem;
        }

        .remover-icon {
            width: 35px;
            height: 35px;
            font-size: 1.1rem;
        }

        .remover-header-text h1 {
            font-size: 1.125rem;
        }

        .remover-header-text p {
            font-size: 0.75rem;
        }

        .remover-tool-section,
        .remover-settings-section {
            padding: 0.875rem;
        }

        .model-option {
            padding: 0.625rem;
        }

        .model-name {
            font-size: 0.8rem;
        }

        .model-description {
            font-size: 0.65rem;
        }

        .model-badge {
            padding: 0.1rem 0.3rem;
            font-size: 0.55rem;
        }

        .quality-option {
            padding: 0.375rem;
            min-height: 40px;
        }

        .quality-name {
            font-size: 0.7rem;
        }

        .upload-area {
            padding: 1.25rem 0.5rem;
            min-height: 90px;
        }

        .upload-icon {
            font-size: 1.75rem;
        }

        .upload-text h4 {
            font-size: 0.875rem;
        }

        .upload-text p {
            font-size: 0.75rem;
        }

        .upload-text small {
            font-size: 0.65rem;
        }

        .file-info {
            padding: 0.75rem;
        }

        .file-name {
            font-size: 0.85rem;
        }

        .file-details {
            font-size: 0.75rem;
        }

        .preview-item {
            padding: 0.625rem;
        }

        .preview-label {
            font-size: 0.8rem;
        }

        .preview-image {
            max-height: 120px;
        }

        .empty-state {
            font-size: 0.75rem;
            padding: 0.625rem;
        }

        .btn-process, .btn-download, .btn-new {
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
            min-height: 44px;
        }

        .processing-spinner {
            width: 40px;
            height: 40px;
        }

        .processing-text {
            font-size: 0.9rem;
        }

        .processing-subtext {
            font-size: 0.75rem;
        }

        .info-tips h6 {
            font-size: 0.85rem;
        }

        .tips-list li {
            font-size: 0.75rem;
        }
    }

    /* Touch improvements */
    @media (hover: none) and (pointer: coarse) {
        .model-option:hover,
        .quality-option:hover,
        .btn-process:hover,
        .btn-download:hover,
        .btn-new:hover,
        .upload-area:hover {
            transform: none;
        }

        .model-option:active,
        .quality-option:active {
            transform: scale(0.98);
        }

        .btn-process:active,
        .btn-download:active,
        .btn-new:active {
            transform: scale(0.98);
        }

        .upload-area:active {
            transform: scale(1.01);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="remover-wrapper">
    <!-- Header -->
    <div class="remover-header">
        <div class="remover-header-content">
            <div class="remover-icon">
                <i class="fas fa-cut"></i>
            </div>
            <div class="remover-header-text">
                <h1>Removedor de Fundo IA</h1>
                <p>Escolha o modelo e qualidade para remover fundos automaticamente</p>
            </div>
        </div>
    </div>

    <!-- Layout Principal -->
    <div class="remover-main-layout">
        <!-- Ferramenta Principal -->
        <div class="remover-tool-section">
            <h3 style="margin-bottom: 1.5rem; color: var(--text-primary); font-weight: 700;">
                <i class="fas fa-magic" style="color: var(--primary); margin-right: 0.5rem;"></i>
                Remover Fundo
            </h3>

            <!-- Upload Area -->
            <div class="upload-area" id="upload-area">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-text">
                    <h4>Arraste sua imagem aqui</h4>
                    <p>ou toque para selecionar um arquivo</p>
                    <small style="color: var(--text-muted);">Suporta: JPG, PNG, WEBP (m√°x. 16MB)</small>
                </div>
                <input type="file" id="file-input" accept="image/*" style="display: none;">
            </div>

            <!-- File Info -->
            <div class="file-info" id="file-info">
                <div class="file-name" id="file-name">
                    <i class="fas fa-image"></i>
                    <span></span>
                </div>
                <div class="file-details">
                    <div class="file-detail">
                        <span class="file-detail-label">Tamanho</span>
                        <span id="file-size"></span>
                    </div>
                    <div class="file-detail">
                        <span class="file-detail-label">Dimens√µes</span>
                        <span id="file-dimensions"></span>
                    </div>
                    <div class="file-detail">
                        <span class="file-detail-label">Formato</span>
                        <span id="file-format"></span>
                    </div>
                </div>
            </div>

            <!-- Processing Area -->
            <div class="processing-area" id="processing-area">
                <div class="processing-spinner"></div>
                <div class="processing-text">Removendo fundo...</div>
                <div class="processing-subtext">Processando com <span id="processing-model"></span></div>
            </div>

            <div class="alert-message" id="status-message"></div>

            <!-- Preview Area -->
            <div class="preview-area" id="preview-area">
                <div class="preview-container">
                    <div class="preview-item">
                        <div class="preview-label">
                            <i class="fas fa-image"></i>
                            Original
                        </div>
                        <img id="original-preview" class="preview-image" alt="Imagem original">
                    </div>
                    <div class="preview-item">
                        <div class="preview-label">
                            <i class="fas fa-cut"></i>
                            Sem Fundo
                        </div>
                        <img id="processed-preview" class="preview-image" alt="Imagem sem fundo" 
                             style="display:none; background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%); background-size: 20px 20px; background-position: 0 0, 0 10px, 10px -10px, -10px 0px;">
                        <div class="empty-state" id="processed-empty">
                            Processe a imagem para ver o resultado
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bot√µes -->
            <button class="btn-process" id="process-btn" disabled>
                <i class="fas fa-magic"></i>
                Remover Fundo
            </button>

            <button class="btn-download" id="download-btn">
                <i class="fas fa-download"></i>
                Baixar Imagem sem Fundo
            </button>

            <button class="btn-new" id="new-btn">
                <i class="fas fa-plus"></i>
                Processar Nova Imagem
            </button>
        </div>

        <!-- Configura√ß√µes (Lado Direito) -->
        <div class="remover-settings-section">
            <!-- Seletor de Modelo -->
            <div class="model-selector">
                <h4>
                    <i class="fas fa-robot"></i>
                    Modelo de IA
                </h4>
                <div class="model-grid" id="model-grid">
                    <!-- Modelos ser√£o carregados via JS -->
                </div>
            </div>

            <!-- Qualidade -->
            <div class="quality-selector">
                <h5>
                    <i class="fas fa-sliders-h"></i>
                    Qualidade
                </h5>
                <div class="quality-options">
                    <label class="quality-option active">
                        <input type="radio" name="quality" value="alta" checked>
                        <div class="quality-name">Alta</div>
                    </label>
                    <label class="quality-option">
                        <input type="radio" name="quality" value="maxima">
                        <div class="quality-name">M√°xima</div>
                    </label>
                    <label class="quality-option">
                        <input type="radio" name="quality" value="media">
                        <div class="quality-name">M√©dia</div>
                    </label>
                    <label class="quality-option">
                        <input type="radio" name="quality" value="rapida">
                        <div class="quality-name">R√°pida</div>
                    </label>
                </div>
            </div>

            <!-- Dicas -->
            <div class="info-tips">
                <h6>
                    <i class="fas fa-lightbulb"></i>
                    Dicas
                </h6>
                <ul class="tips-list">
                    <li><strong>ISNet:</strong> Melhor para objetos e produtos</li>
                    <li><strong>U¬≤-Net Pessoas:</strong> Ideal para retratos</li>
                    <li><strong>MediaPipe:</strong> Muito r√°pido para selfies</li>
                    <li><strong>Silueta:</strong> Processamento instant√¢neo</li>
                    <li>Use "Qualidade M√°xima" para melhores resultados</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
// Vari√°veis globais
let selectedFile = null;
let uploadedFilename = null;
let processedFilename = null;
let originalObjectUrl = null;
let processedObjectUrl = null;
let availableModels = {};

const allowedExtensions = ['png','jpg','jpeg','webp','bmp'];

// Elementos DOM
const uploadArea = document.getElementById('upload-area');
const fileInput = document.getElementById('file-input');
const fileInfo = document.getElementById('file-info');
const fileName = document.getElementById('file-name').querySelector('span');
const fileSize = document.getElementById('file-size');
const fileDimensions = document.getElementById('file-dimensions');
const fileFormat = document.getElementById('file-format');
const processBtn = document.getElementById('process-btn');
const downloadBtn = document.getElementById('download-btn');
const newBtn = document.getElementById('new-btn');
const processingArea = document.getElementById('processing-area');
const processingModel = document.getElementById('processing-model');
const previewArea = document.getElementById('preview-area');
const originalPreview = document.getElementById('original-preview');
const processedPreview = document.getElementById('processed-preview');
const processedEmpty = document.getElementById('processed-empty');
const statusMessage = document.getElementById('status-message');
const modelGrid = document.getElementById('model-grid');

// Inicializar
document.addEventListener('DOMContentLoaded', loadModels);

// Event listeners
uploadArea.addEventListener('click', () => fileInput.click());
uploadArea.addEventListener('dragover', handleDragOver);
uploadArea.addEventListener('dragleave', handleDragLeave);
uploadArea.addEventListener('drop', handleDrop);
fileInput.addEventListener('change', handleFileSelect);
processBtn.addEventListener('click', processImage);
downloadBtn.addEventListener('click', downloadImage);
newBtn.addEventListener('click', resetTool);

// Touch events for mobile
uploadArea.addEventListener('touchstart', (e) => {
    e.preventDefault();
    fileInput.click();
}, { passive: false });

// Carregar modelos dispon√≠veis
async function loadModels() {
    try {
        const response = await fetch('/removedor-de-fundo/models');
        const data = await response.json();
        availableModels = data.models;
        renderModels();
    } catch (error) {
        console.error('Erro ao carregar modelos:', error);
        // Fallback com modelos b√°sicos
        availableModels = {
            'isnet-general-use': {
                'name': 'ISNet (Melhor)',
                'description': 'Modelo mais preciso',
                'speed': 'M√©dio',
                'quality': 'Excelente'
            },
            'u2net': {
                'name': 'U¬≤-Net (R√°pido)',
                'description': 'Equil√≠brio velocidade/qualidade',
                'speed': 'R√°pido',
                'quality': 'Boa'
            }
        };
        renderModels();
    }
}

// Renderizar seletor de modelos
function renderModels() {
    const modelGrid = document.getElementById('model-grid');
    modelGrid.innerHTML = '';
    
    let first = true;
    for (const [modelId, modelInfo] of Object.entries(availableModels)) {
        const modelOption = document.createElement('label');
        modelOption.className = `model-option ${first ? 'active' : ''}`;
        
        modelOption.innerHTML = `
            <input type="radio" name="model" value="${modelId}" ${first ? 'checked' : ''}>
            <div class="model-name">${modelInfo.name}</div>
            <div class="model-description">${modelInfo.description}</div>
            <div class="model-badges">
                <span class="model-badge speed">‚ö° ${modelInfo.speed}</span>
                <span class="model-badge quality">üéØ ${modelInfo.quality}</span>
            </div>
        `;
        
        modelOption.addEventListener('click', () => selectModel(modelOption));
        
        // Touch feedback
        modelOption.addEventListener('touchstart', () => {
            modelOption.style.transform = 'scale(0.98)';
        }, { passive: true });
        
        modelOption.addEventListener('touchend', () => {
            setTimeout(() => {
                modelOption.style.transform = '';
            }, 150);
        }, { passive: true });
        
        modelGrid.appendChild(modelOption);
        first = false;
    }
    
    // Quality selector
    document.querySelectorAll('input[name="quality"]').forEach(input => {
        input.addEventListener('change', () => selectQuality(input.closest('.quality-option')));
    });
    
    // Touch feedback for quality options
    document.querySelectorAll('.quality-option').forEach(option => {
        option.addEventListener('touchstart', () => {
            option.style.transform = 'scale(0.98)';
        }, { passive: true });
        
        option.addEventListener('touchend', () => {
            setTimeout(() => {
                option.style.transform = '';
            }, 150);
        }, { passive: true });
    });
}

// Selecionar modelo
function selectModel(option) {
    document.querySelectorAll('.model-option').forEach(opt => opt.classList.remove('active'));
    option.classList.add('active');
    option.querySelector('input').checked = true;
}

// Selecionar qualidade
function selectQuality(option) {
    document.querySelectorAll('.quality-option').forEach(opt => opt.classList.remove('active'));
    option.classList.add('active');
}

// Drag and drop handlers
function handleDragOver(e) {
    e.preventDefault();
    uploadArea.classList.add('dragover');
}

function handleDragLeave(e) {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
}

function handleDrop(e) {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0 && files[0].type.startsWith('image/')) {
        handleFile(files[0]);
    }
}

function handleFileSelect(e) {
    const file = e.target.files[0];
    if (file) {
        handleFile(file);
    }
}

// Handle file
async function handleFile(file) {
    if (file.size > 16 * 1024 * 1024) {
        alert('Arquivo muito grande! M√°ximo: 16MB');
        resetTool(false);
        return;
    }

    const extension = file.name.split('.').pop().toLowerCase();
    if (!allowedExtensions.includes(extension)) {
        setStatus('error', 'Formato n√£o suportado. Use PNG, JPG, JPEG, WEBP ou BMP.');
        resetTool(false);
        return;
    }

    selectedFile = file;
    uploadedFilename = null;
    processedFilename = null;
    downloadBtn.classList.remove('show');
    newBtn.classList.remove('show');
    processedPreview.style.display = 'none';
    processedEmpty.style.display = 'block';
    previewArea.classList.remove('show');

    // Show file info
    fileName.textContent = file.name;
    fileSize.textContent = formatFileSize(file.size);
    fileFormat.textContent = file.type.split('/')[1].toUpperCase();
    
    // Get dimensions
    const img = new Image();
    img.onload = function() {
        fileDimensions.textContent = `${this.width} √ó ${this.height}px`;
        
        if (originalObjectUrl) {
            URL.revokeObjectURL(originalObjectUrl);
        }
        originalObjectUrl = URL.createObjectURL(file);
        originalPreview.src = originalObjectUrl;
        
        fileInfo.classList.add('show');
        processBtn.disabled = true;
        previewArea.classList.add('show');
        processedPreview.style.display = 'none';
        processedEmpty.style.display = 'block';
        
        uploadArea.style.display = 'none';
        uploadToServer(file);
    };
    img.src = URL.createObjectURL(file);
}

// Upload to server
async function uploadToServer(file) {
    try {
        setStatus('info', 'Enviando imagem...');
        const formData = new FormData();
        formData.append('file', file);
        const response = await fetch('/removedor-de-fundo/upload', {
            method: 'POST',
            body: formData
        });
        const result = await response.json();
        if (!response.ok || !result.success) {
            throw new Error(result.error || 'Falha no upload');
        }
        uploadedFilename = result.filename;
        processBtn.disabled = false;
        setStatus('success', 'Pronta! Configure o modelo e toque em "Remover Fundo".');
    } catch (error) {
        setStatus('error', error.message);
        processBtn.disabled = true;
        resetTool(false);
    }
}

// Format file size
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Process image
async function processImage() {
    if (!uploadedFilename) {
        setStatus('error', 'Envie uma imagem primeiro.');
        return;
    }

    const selectedModel = document.querySelector('input[name="model"]:checked').value;
    const selectedQuality = document.querySelector('input[name="quality"]:checked').value;
    
    try {
        processBtn.disabled = true;
        processBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
        processingArea.classList.add('show');
        processingModel.textContent = availableModels[selectedModel].name;
        setStatus('info', 'Removendo fundo...');

        const response = await fetch('/removedor-de-fundo/process', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                filename: uploadedFilename,
                model: selectedModel,
                quality: selectedQuality
            })
        });
        
        const result = await response.json();
        if (!response.ok || !result.success) {
            throw new Error(result.error || 'Falha no processamento');
        }

        processedFilename = result.output_filename;
        const previewUrl = `${result.preview_url}?v=${Date.now()}`;
        
        if (processedObjectUrl) {
            URL.revokeObjectURL(processedObjectUrl);
            processedObjectUrl = null;
        }
        
        processedPreview.src = previewUrl;
        processedPreview.style.display = 'block';
        processedEmpty.style.display = 'none';
        previewArea.classList.add('show');
        downloadBtn.classList.add('show');
        newBtn.classList.add('show');
        setStatus('success', 'Pronto! Veja o resultado e fa√ßa o download.');
        
    } catch (error) {
        setStatus('error', error.message);
        resetTool(false);
    } finally {
        processingArea.classList.remove('show');
        processBtn.disabled = false;
        processBtn.innerHTML = '<i class="fas fa-magic"></i> Remover Fundo';
    }
}

// Download image
function downloadImage() {
    if (!processedFilename) {
        setStatus('error', 'Nada para baixar.');
        return;
    }
    window.open(`/removedor-de-fundo/download/${processedFilename}`, '_blank');
}

// Reset tool
function resetTool(clearStatus = true) {
    selectedFile = null;
    uploadedFilename = null;
    processedFilename = null;
    originalObjectUrl && URL.revokeObjectURL(originalObjectUrl);
    processedObjectUrl && URL.revokeObjectURL(processedObjectUrl);
    originalObjectUrl = null;
    processedObjectUrl = null;
    
    uploadArea.style.display = 'block';
    fileInfo.classList.remove('show');
    previewArea.classList.remove('show');
    processingArea.classList.remove('show');
    downloadBtn.classList.remove('show');
    newBtn.classList.remove('show');
    processedPreview.style.display = 'none';
    processedEmpty.style.display = 'block';
    originalPreview.src = '';
    
    processBtn.disabled = true;
    processBtn.innerHTML = '<i class="fas fa-magic"></i> Remover Fundo';
    fileInput.value = '';

    if (clearStatus) {
        statusMessage.classList.remove('show', 'info', 'error', 'success');
        statusMessage.textContent = '';
    }
}

// Set status message
function setStatus(type, message) {
    statusMessage.classList.remove('show', 'info', 'error', 'success');
    if (!message) return;
    statusMessage.textContent = message;
    statusMessage.classList.add('show', type);
}

// Prevent zoom on double tap for iOS
document.addEventListener('touchstart', (e) => {
    if (e.touches.length > 1) {
        e.preventDefault();
    }
}, { passive: false });

let lastTouchEnd = 0;
document.addEventListener('touchend', (e) => {
    const now = (new Date()).getTime();
    if (now - lastTouchEnd <= 300) {
        e.preventDefault();
    }
    lastTouchEnd = now;
}, false);
</script>
{% endblock %}