{% extends 'nexuspdf_base.html' %}

{% block title %}OCR em PDF Online | Converter PDF Escaneado em Texto - NexusPDF{% endblock %}

{% block meta_description %}Use o OCR em PDF online do NexusPDF para converter PDFs escaneados e imagens em texto pesquisável. Extraia texto de boletos, contratos, relatórios e documentos digitalizados em português de forma rápida e segura.{% endblock %}
{% block meta_keywords %}ocr pdf online, ocr em pdf, converter pdf escaneado em texto, extrair texto de pdf, reconhecimento de texto em pdf, pdf imagem para texto, ocr portugues, nexuspdf ocr{% endblock %}

{% block extra_styles %}
    {{ super() }}
{% endblock %}
{% block pdf_suite_title %}OCR em PDF{% endblock %}

{% block pdf_suite_subtitle %}Envie um PDF escaneado e extraia texto pesquisável com reconhecimento de caracteres (português e outros idiomas).{% endblock %}

{% block pdf_suite_content %}
<div class="pdf-suite-grid">
    <section class="pdf-suite-panel">
        <div class="pdf-suite-panel-title"><i class="bi bi-cloud-upload"></i> Enviar arquivo</div>

        <form id="ocr-form" action="{{ url_for('nexuspdf_ocr_pdf.ocr_pdf') }}" method="post" enctype="multipart/form-data">
            <div class="pdf-suite-field">
                <label class="pdf-suite-label">Arquivo PDF</label>
                <input type="file" name="pdf_file" accept="application/pdf" required class="pdf-suite-input" />
                <div class="pdf-suite-hint">Documentos grandes podem levar alguns minutos. Se travar, tente um PDF menor.</div>
                <div class="pdf-suite-file-summary" data-file-summary></div>
            </div>

            <div class="pdf-suite-actions">
                <button type="submit" class="btn-primary-ocr" id="ocr-submit-btn">
                    <i class="bi bi-file-earmark-text"></i>
                    Executar OCR
                </button>
            </div>

            <div class="pdf-suite-progress" id="ocr-progress">
                <div class="pdf-suite-progress-label">
                    Processando PDF... <span id="ocr-progress-percent" style="margin-left: 0.35rem;">0%</span>
                </div>
                <div class="pdf-suite-progress-track">
                    <div class="pdf-suite-progress-bar" id="ocr-progress-bar"></div>
                </div>
            </div>
        </form>

        <div class="adsense-slot" style="margin-top: 1.25rem; text-align: center;"></div>
    </section>

    <section class="pdf-suite-panel">
        <div class="pdf-suite-panel-title"><i class="bi bi-file-earmark-font"></i> Texto extraído</div>

        {% if extracted_text %}
            <pre class="pdf-suite-pre">{{ extracted_text }}</pre>
            {% if txt_filename %}
            <div class="pdf-suite-actions" style="margin-top: 0.9rem;">
                <a href="{{ url_for('nexuspdf_ocr_pdf.ocr_pdf_download', txt_filename=txt_filename) }}" class="btn-primary-ocr" style="text-decoration: none;">
                    <i class="bi bi-download"></i>
                    Baixar .txt
                </a>
            </div>
            {% endif %}
        {% else %}
            <div class="pdf-suite-hint">O texto extraído vai aparecer aqui após o processamento.</div>
        {% endif %}
    </section>
</div>

<section class="pdf-suite-panel" style="margin-top: 1.25rem;">
    <div class="pdf-suite-panel-title"><i class="bi bi-info-circle"></i> Sobre o OCR</div>
    <div class="pdf-suite-hint">
        OCR (Reconhecimento Óptico de Caracteres) transforma PDFs que são apenas imagens em texto copiável e pesquisável.
        É ideal para contratos, boletos, relatórios e documentos digitalizados.
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('ocr-form');
    const submitBtn = document.getElementById('ocr-submit-btn');
    const progressWrapper = document.getElementById('ocr-progress');
    const progressBar = document.getElementById('ocr-progress-bar');
    const progressPercent = document.getElementById('ocr-progress-percent');

    if (!form || !submitBtn || !progressWrapper || !progressBar || !progressPercent) {
        return;
    }

    form.addEventListener('submit', function () {
        // Só mostra a barra se houver arquivo selecionado
        const fileInput = form.querySelector('input[name="pdf_file"]');
        if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
            return;
        }

        submitBtn.disabled = true;
        submitBtn.style.opacity = '0.7';
        submitBtn.style.cursor = 'not-allowed';
        submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Processando...';

        progressWrapper.classList.add('active');

        let current = 0;
        const maxBeforeFinish = 90; // deixa 10% para o carregamento final da página

        const interval = setInterval(function () {
            if (current < maxBeforeFinish) {
                current += 2;
                progressBar.style.width = current + '%';
                progressPercent.textContent = current + '%';
            } else {
                clearInterval(interval);
            }
        }, 250);
    });
});
</script>
{% endblock %}
