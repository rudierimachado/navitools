{% extends 'nexuspdf_base.html' %}

{% block title %}Editar PDF - NexusPDF{% endblock %}

{% block meta_description %}Editor de PDF online NexusPDF: adicione marca d'água, números de página e rotacione PDFs com facilidade, sem instalar programas.{% endblock %}
{% block meta_keywords %}editar pdf, marca d'água pdf, números de página pdf, rotacionar pdf, editor pdf online, nexuspdf editor{% endblock %}

{% block extra_styles %}
    {{ super() }}
    <style>
        .pdf-suite-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            border-bottom: 1px solid rgba(148, 163, 184, 0.25);
            margin-bottom: 1.1rem;
        }

        .pdf-suite-tab {
            border: 1px solid transparent;
            background: transparent;
            color: rgba(226, 232, 240, 0.75);
            padding: 0.55rem 0.9rem;
            border-radius: 999px;
            font-weight: 900;
            cursor: pointer;
            transition: var(--transition-base);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pdf-suite-tab:hover {
            color: rgba(248, 250, 252, 0.95);
            border-color: rgba(148, 163, 184, 0.25);
            background: rgba(2, 6, 23, 0.35);
        }

        .pdf-suite-tab.active {
            color: #fff;
            border-color: transparent;
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.95), rgba(99, 102, 241, 0.95));
            box-shadow: 0 14px 40px rgba(14, 165, 233, 0.22);
        }

        .pdf-suite-tab-content {
            display: none;
        }

        .pdf-suite-tab-content.active {
            display: block;
        }

        .pdf-suite-choice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 0.75rem;
        }

        .pdf-suite-choice {
            cursor: pointer;
        }

        .pdf-suite-choice input {
            display: none;
        }

        .pdf-suite-choice span {
            display: block;
            padding: 0.65rem 0.9rem;
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            background: rgba(2, 6, 23, 0.35);
            text-align: center;
            font-size: 0.9rem;
            font-weight: 800;
            color: rgba(226, 232, 240, 0.9);
            transition: var(--transition-base);
        }

        .pdf-suite-choice input:checked + span {
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.95), rgba(99, 102, 241, 0.95));
            border-color: transparent;
            color: #fff;
            box-shadow: 0 14px 40px rgba(14, 165, 233, 0.22);
        }
    </style>
{% endblock %}

{% block pdf_suite_title %}Editar PDF{% endblock %}

{% block pdf_suite_subtitle %}Adicione marca d'água, números de página ou rotacione seu PDF — com resultado pronto para download.{% endblock %}

{% block pdf_suite_content %}
<div class="pdf-suite-grid">
    <section class="pdf-suite-panel">
        <div class="pdf-suite-panel-title"><i class="bi bi-pencil-square"></i> Edição</div>

        <form action="{{ url_for('nexuspdf_editar_pdf.editar_pdf') }}" method="post" enctype="multipart/form-data">
            <div class="pdf-suite-field">
                <label class="pdf-suite-label">Arquivo PDF</label>
                <input type="file" name="pdf_file" accept="application/pdf" required class="pdf-suite-input" />
                <div class="pdf-suite-file-summary" data-file-summary></div>
            </div>

            <div class="pdf-suite-tabs" role="tablist" aria-label="Opções de edição">
                <button type="button" class="pdf-suite-tab active" onclick="switchTab(event, 'watermark')">
                    <i class="bi bi-droplet"></i> Marca d'água
                </button>
                <button type="button" class="pdf-suite-tab" onclick="switchTab(event, 'page_numbers')">
                    <i class="bi bi-123"></i> Páginas
                </button>
                <button type="button" class="pdf-suite-tab" onclick="switchTab(event, 'rotate')">
                    <i class="bi bi-arrow-clockwise"></i> Rotação
                </button>
            </div>

            <div id="watermark" class="pdf-suite-tab-content active">
                <div class="pdf-suite-field">
                    <label class="pdf-suite-label">Texto da marca d'água</label>
                    <input type="text" name="watermark_text" value="CONFIDENCIAL" class="pdf-suite-input" placeholder="Digite o texto" />
                </div>

                <div class="pdf-suite-field">
                    <label class="pdf-suite-label">Opacidade</label>
                    <input type="range" name="opacity" min="0.1" max="1" step="0.1" value="0.3" class="pdf-suite-input" style="padding: 0.55rem;" />
                    <div class="pdf-suite-hint">Ajuste a transparência da marca.</div>
                </div>
            </div>

            <div id="page_numbers" class="pdf-suite-tab-content">
                <div class="pdf-suite-field">
                    <label class="pdf-suite-label">Página inicial</label>
                    <input type="number" name="start_page" value="1" min="1" class="pdf-suite-input" />
                </div>

                <div class="pdf-suite-field">
                    <label class="pdf-suite-label">Posição dos números</label>
                    <div class="pdf-suite-choice-grid">
                        <label class="pdf-suite-choice"><input type="radio" name="position" value="bottom_right" checked><span>Inferior direita</span></label>
                        <label class="pdf-suite-choice"><input type="radio" name="position" value="bottom_center"><span>Inferior centro</span></label>
                        <label class="pdf-suite-choice"><input type="radio" name="position" value="bottom_left"><span>Inferior esquerda</span></label>
                        <label class="pdf-suite-choice"><input type="radio" name="position" value="top_right"><span>Superior direita</span></label>
                        <label class="pdf-suite-choice"><input type="radio" name="position" value="top_center"><span>Superior centro</span></label>
                        <label class="pdf-suite-choice"><input type="radio" name="position" value="top_left"><span>Superior esquerda</span></label>
                    </div>
                </div>
            </div>

            <div id="rotate" class="pdf-suite-tab-content">
                <div class="pdf-suite-field">
                    <label class="pdf-suite-label">Ângulo de rotação</label>
                    <div class="pdf-suite-choice-grid">
                        <label class="pdf-suite-choice"><input type="radio" name="rotation" value="90" checked><span>90°</span></label>
                        <label class="pdf-suite-choice"><input type="radio" name="rotation" value="180"><span>180°</span></label>
                        <label class="pdf-suite-choice"><input type="radio" name="rotation" value="270"><span>270°</span></label>
                    </div>
                </div>
            </div>

            <input type="hidden" name="edit_type" value="watermark" />

            <div class="pdf-suite-actions">
                <button type="submit" class="btn-primary-edit">
                    <i class="bi bi-magic"></i>
                    Aplicar edição
                </button>
            </div>
        </form>

        <div class="adsense-slot" style="margin-top: 1.25rem; text-align: center;"></div>
    </section>

    <section class="pdf-suite-panel">
        <div class="pdf-suite-panel-title"><i class="bi bi-check2-circle"></i> Resultado</div>

        {% if result %}
            <div class="pdf-suite-hint">
                <div><strong>Status:</strong> PDF editado com sucesso.</div>
                {% if result.type == 'watermark' %}
                    <div><strong>Marca d'água:</strong> "{{ result.watermark_text }}"</div>
                {% elif result.type == 'page_numbers' %}
                    <div><strong>Numeração:</strong> a partir da página {{ result.start_page }} · {{ result.position|replace('_', ' ')|title }}</div>
                {% elif result.type == 'rotate' %}
                    <div><strong>Rotação:</strong> {{ result.rotation }}°</div>
                {% endif %}
            </div>
            <div class="pdf-suite-actions" style="margin-top: 0.9rem;">
                <a href="{{ url_for('nexuspdf_editar_pdf.editar_pdf_download', filename=result.filename) }}" class="btn-primary-edit" style="text-decoration: none;">
                    <i class="bi bi-download"></i>
                    Baixar PDF
                </a>
            </div>
        {% else %}
            <div class="pdf-suite-hint">Escolha uma edição e envie um PDF para gerar o arquivo final.</div>
        {% endif %}
    </section>
</div>

<section class="pdf-suite-panel" style="margin-top: 1.25rem;">
    <div class="pdf-suite-panel-title"><i class="bi bi-shield-check"></i> Dicas</div>
    <div class="pdf-suite-hint">
        Use marca d'água para documentos confidenciais, numeração para facilitar referência e rotação para corrigir digitalizações.
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
function switchTab(evt, tabName) {
    // Esconder todos os tabs
    const tabs = document.querySelectorAll('.pdf-suite-tab-content');
    tabs.forEach(tab => tab.classList.remove('active'));

    // Remover active de todos os botões
    const buttons = document.querySelectorAll('.pdf-suite-tab');
    buttons.forEach(btn => btn.classList.remove('active'));
    
    // Mostrar tab selecionado
    const selectedTab = document.getElementById(tabName);
    if (selectedTab) {
        selectedTab.classList.add('active');
    }
    
    // Adicionar active ao botão clicado
    if (evt && evt.target) {
        const btn = evt.target.closest('.pdf-suite-tab');
        if (btn) {
            btn.classList.add('active');
        }
    }
    
    // Atualizar o valor do edit_type no formulário
    const form = document.querySelector('form');
    if (form) {
        const editTypeInput = form.querySelector('input[name="edit_type"]');
        if (editTypeInput) {
            editTypeInput.value = tabName;
        }
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Garantir que a primeira aba esteja ativa ao carregar
    const firstTab = document.querySelector('.pdf-suite-tab-content');
    if (firstTab) {
        firstTab.classList.add('active');
    }
    const firstButton = document.querySelector('.pdf-suite-tab');
    if (firstButton) {
        firstButton.classList.add('active');
    }
});
</script>
{% endblock %}
