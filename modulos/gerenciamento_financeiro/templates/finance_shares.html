{% extends 'finance_base.html' %}

{% block title %}Compartilhamentos · NexusRDR{% endblock %}

{% block content %}
<div class="container py-4">
    <h1 class="h4 mb-4">
        <i class="bi bi-share me-2"></i>Compartilhamentos do Sistema
    </h1>

    {# MENSAGENS FLASH #}
    {% with messages = get_flashed_messages(with_categories=True) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show mb-3" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Convites que eu enviei -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <strong><i class="bi bi-send me-2"></i>Convites enviados por mim</strong>
        </div>
        <div class="card-body p-0">
            {% if sent_shares %}
                <div class="table-responsive">
                    <table class="table table-sm mb-0 align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Email convidado</th>
                                <th>Tipo</th>
                                <th>Nível de acesso</th>
                                <th>Status</th>
                                <th>Enviado em</th>
                                <th>Aceito em</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for s in sent_shares %}
                            <tr>
                                <td>{{ s.shared_email }}</td>
                                <td>
                                    {% if s.share_type == 'family' %}
                                        <span class="badge bg-info">
                                            <i class="bi bi-people me-1"></i>Membro da família
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">
                                            <i class="bi bi-briefcase me-1"></i>Contador/Consultor
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-light text-dark">{{ s.access_level|capitalize }}</span>
                                </td>
                                <td>
                                    {% if s.status == 'pending' %}
                                        <span class="badge bg-warning text-dark">
                                            <i class="bi bi-clock me-1"></i>Pendente
                                        </span>
                                    {% elif s.status == 'accepted' %}
                                        <span class="badge bg-success">
                                            <i class="bi bi-check-circle me-1"></i>Aceito
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ s.status }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <small>{{ s.created_at.strftime('%d/%m/%Y %H:%M') if s.created_at }}</small>
                                </td>
                                <td>
                                    <small>{{ s.accepted_at.strftime('%d/%m/%Y %H:%M') if s.accepted_at else '-' }}</small>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="p-4 text-center text-muted">
                    <i class="bi bi-inbox display-4 d-block mb-3"></i>
                    <p class="mb-0">Você ainda não enviou nenhum convite.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Compartilhamentos que tenho acesso -->
    <div class="card">
        <div class="card-header bg-success text-white">
            <strong><i class="bi bi-key me-2"></i>Contas que tenho acesso</strong>
        </div>
        <div class="card-body p-0">
            {% if received_shares %}
                <div class="table-responsive">
                    <table class="table table-sm mb-0 align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Email do proprietário</th>
                                <th>Tipo</th>
                                <th>Nível de acesso</th>
                                <th>Aceito em</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for s in received_shares %}
                            <tr>
                                <td>{{ s.owner.email }}</td>
                                <td>
                                    {% if s.share_type == 'family' %}
                                        <span class="badge bg-info">
                                            <i class="bi bi-people me-1"></i>Membro da família
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">
                                            <i class="bi bi-briefcase me-1"></i>Contador/Consultor
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-light text-dark">{{ s.access_level|capitalize }}</span>
                                </td>
                                <td>
                                    <small>{{ s.accepted_at.strftime('%d/%m/%Y %H:%M') if s.accepted_at else '-' }}</small>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="p-4 text-center text-muted">
                    <i class="bi bi-inbox display-4 d-block mb-3"></i>
                    <p class="mb-0">Nenhum compartilhamento ativo para sua conta.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
